PROC SQL;
	ALTER TABLE WORK.IMPORT ADD cp_0 INT ADD cp_1 INT ADD cp_2 INT ADD cp_3 INT;
	RUN;
QUIT;

DATA WORK.IMPORT;
	SET WORK.IMPORT;

	IF cp="0" THEN
		cp_0="1";
	ELSE
		cp_0="0";
RUN;

QUIT;

DATA WORK.IMPORT;
	SET WORK.IMPORT;

	IF cp="1" THEN
		cp_1="1";
	ELSE
		cp_1="0";
RUN;

QUIT;

DATA WORK.IMPORT;
	SET WORK.IMPORT;

	IF cp="2" THEN
		cp_2="1";
	ELSE
		cp_2="0";
RUN;

QUIT;

DATA WORK.IMPORT;
	SET WORK.IMPORT;

	IF cp="3" THEN
		cp_3="1";
	ELSE
		cp_3="0";
RUN;

QUIT;

PROC SQL;
	ALTER TABLE WORK.IMPORT ADD thal_0 INT ADD thal_1 INT ADD thal_2 INT ADD 
		thal_3 INT;
	RUN;
QUIT;

DATA WORK.IMPORT;
	SET WORK.IMPORT;

	IF thal="0" THEN
		thal_0="1";
	ELSE
		thal_0="0";
RUN;

QUIT;

DATA WORK.IMPORT;
	SET WORK.IMPORT;

	IF thal="1" THEN
		thal_1="1";
	ELSE
		thal_1="0";
RUN;

QUIT;

DATA WORK.IMPORT;
	SET WORK.IMPORT;

	IF thal="2" THEN
		thal_2="1";
	ELSE
		thal_2="0";
RUN;

QUIT;

DATA WORK.IMPORT;
	SET WORK.IMPORT;

	IF thal="3" THEN
		thal_3="1";
	ELSE
		thal_3="0";
RUN;

QUIT;


PROC SQL;
	ALTER TABLE WORK.IMPORT ADD slope_0 INT ADD slope_1 INT ADD slope_2 INT;
	RUN;
QUIT;

DATA WORK.IMPORT;
	SET WORK.IMPORT;

	IF slope="0" THEN
		slope_0="1";
	ELSE
		slope_0="0";
RUN;

QUIT;

DATA WORK.IMPORT;
	SET WORK.IMPORT;

	IF slope="1" THEN
		slope_1="1";
	ELSE
		slope_1="0";
RUN;

QUIT;

DATA WORK.IMPORT;
	SET WORK.IMPORT;

	IF slope="2" THEN
		slope_2="1";
	ELSE
		slope_2="0";
RUN;

QUIT;


DATA WORK.IMPORT;
	SET WORK.IMPORT (DROP=cp thal slope);
RUN;


PROC SURVEYSELECT DATA=WORK.IMPORT RAT=0.8 OUT=IMPORT_SELECT OUTALL METHOD=SRS;
RUN;

DATA IMPORT_TRAIN IMPORT_TEST;
	SET IMPORT_SELECT;

	IF Selected="1" THEN
		OUTPUT IMPORT_TRAIN;
	ELSE
		OUTPUT IMPORT_TEST;
RUN;


DATA WORK.IMPORT_TRAIN;
	SET WORK.IMPORT_TRAIN (DROP=Selected);
RUN;

DATA WORK.IMPORT_TEST;
	SET WORK.IMPORT_TEST (DROP=Selected);
RUN;


DATA WORK.IMPORT_TEST;
	SET WORK.IMPORT_TEST;

	IF target="1" THEN
		target=.;
	ELSE
		target=.;
RUN;

QUIT;


PROC LOGISTIC DATA=WORK.IMPORT_TRAIN
		OUTMODEL=WORK.IMPORT_TRAIN_LRMODEL;
	CLASS sex cp_0 cp_1 cp_2 cp_3 fbs restecg exang ca thal_0 thal_1 thal_2 thal_3 slope_0 slope_1 slope_2;
	MODEL target=
	age sex cp_0 cp_1 cp_2 cp_3 trestbps chol fbs restecg thalach exang oldpeak slope_0 slope_1 slope_2 ca thal_0 thal_1 thal_2 thal_3;
	OUTPUT OUT=WORK.IMPORT_TRAIN_LRMODEL_OUTPUT P=PRED_PROB;
RUN;


PROC SQL;
	SELECT * FROM WORK.IMPORT_TRAIN_LRMODEL_OUTPUT;
QUIT;


PROC LOGISTIC INMODEL = WORK.IMPORT_TRAIN_LRMODEL;
SCORE DATA = WORK.IMPORT_TEST
OUT = WORK.IMPORT_PREDICTIONS;
QUIT;


PROC SQL;
	SELECT * FROM WORK.IMPORT_PREDICTIONS;
QUIT;


PROC DATASETS LIBRARY=WORK MEMTYPE=DATA;
	RUN;


	ODS HTML CLOSE;
	ODS PDF CLOSE;
	ODS PDF 
		FILE='/home/u62513277/sasuser.v94/REPORT.pdf';
	OPTIONS NOBYLINE NODATE;
	OPTIONS ORIENTATION = REVERSELANDSCAPELANDSCAPE;
	TITLE 'Heart Disaease Prediction';

PROC REPORT DATA=WORK.IMPORT_PREDICTIONS NOWINDOWS;
	FOOTNOTE '---- End of Report ----';
RUN;

OPTIONS BYLINE;